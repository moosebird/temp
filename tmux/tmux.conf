# https://github.com/samoshkin/tmux-config/blob/master/tmux/tmux.conf

set-environment -g FZF_TMUX 1
bind -N "Create Window at session root" c new-window -c "#{pane_current_path}"
bind -N "Create Window at current" C new-window 
bind -N "Split pane vertically Right" v split-window -h -c "#{pane_current_path}"
bind -N "Split pane vertically Left" V split-window -b -h -c "#{pane_current_path}"
bind -N "Split pane horizontally Down" n split-window -v -c "#{pane_current_path}"
bind -N "Split pane horizontally Up" N split-window -b -v -c "#{pane_current_path}"
bind -N "Swap pane Next" -r ']' swap-pane -D  
bind -N "Swap pane Prev" -r '[' swap-pane -U  
bind -N "Swap Window Next" -r '}' 'swap-window -t +1;select-window -t +1'
bind -N "Swap Window Prev" -r '{' 'swap-window -t -1;select-window -t -1'

bind -N "Swap Pane with First Pane" \\ if '[ #{pane_index} -eq 1 ]' 'swap-pane -s "!"' 'select-pane -t:.1 ; swap-pane -d -t 1 -s "!"'

bind -N "Select Pane 1" -n C-F1 select-pane -t 1
bind -N "Select Pane 2" -n C-F2 select-pane -t 2
bind -N "Select Pane 3" -n C-F3 select-pane -t 3
bind -N "Select Pane 4" -n C-F4 select-pane -t 4
bind -N "Select Pane 5" -n C-F5 select-pane -t 5
bind -N "Select Pane 6" -n C-F6 select-pane -t 6
bind -N "Select Pane 7" -n C-F7 select-pane -t 7
bind -N "Select Pane 8" -n C-F8 select-pane -t 8

bind -N "Select Window 1" -n F1 select-window -t 1
bind -N "Select Window 2" -n F2 select-window -t 2
bind -N "Select Window 3" -n F3 select-window -t 3
bind -N "Select Window 4" -n F4 select-window -t 4
bind -N "Select Window 5" -n F5 select-window -t 5
bind -N "Select Window 6" -n F6 select-window -t 6
bind -N "Select Window 7" -n F7 select-window -t 7
bind -N "Select Window 8" -n F8 select-window -t 8

bind -N "Change to last window" E last-window
bind -N "Change to last pane" e last-pane
bind -N "Toggle Status Bar" y set-option -g status

bind -N "Change to next pane" -n C-NPage next-window
bind -N "Change to next pane" -n C-PPage previous-window

# unbind C-Up
# unbind C-Down
# unbind C-Left
# unbind C-Right
# unbind M-Up
# unbind M-Down
# unbind M-Left
# unbind M-Right
bind -N "Resize pane up" -r C-k resize-pane -U 5
bind -N "Resize pane down" -r C-j resize-pane -D 5
bind -N "Resize pane left" -r C-h  resize-pane -L 5
bind -N "Resize pane right" -r C-l  resize-pane -R 5
bind -N "Spread panes out evenly" C-Space select-layout -E

bind -N "Select the pane above the active pane" -r k select-pane -U
bind -N "Select the pane below the active pane" -r j select-pane -D
bind -N "Select the pane to the left of the active pane" -r h select-pane -L
bind -N "Select the pane to the right of the active pane" -r l select-pane -R
bind -N "Select Pane by number"  q display-panes -d 0

bind-key -N "Join Pane" < join-pane
bind-key -N "Break Pane" , break-pane
bind-key -N "Send Pane to Window" . command-prompt -p "Send pane to window: "  "join-pane -t :'%%'"
bind-key -N "Send Window to Session" > command-prompt -p "Send window to session: "  "move-window -t '%%':"
#bind-key -N "Find Window" W command-prompt "find-window -Z -- '%%'"
#bind-key -N "Choose a session from a list" s choose-tree -Zs
bind-key -N "Choose a session from a list" s choose-tree -ZsK '#{?#{e|<:#{line},9},#{e|+:1,#{line}},#{?#{e|<:#{line},35},M-#{a:#{e|+:97,#{e|-:#{line},9}}},}}'
bind-key -N "Detach the current client" d detach-client

bind -N "Kill Window" X confirm-before -p "kill window #I (#W)? (y/n)" "kill-window"
bind -N "Kill Session" C-x confirm-before -p "kill session #S? (y/n)" "kill-session"

bind-key -N "Open Session or Start Session" S run-shell "tmux neww ~/.config/tmux/create-session.sh"

#bind-key    -T prefix       ,                    command-prompt -I "#W" "rename-window -- '%%'"
#bind-key    -T prefix       .                    command-prompt -T "move-window -t '%%'"
bind -N "Lookup key" "'" command-prompt -k -p key "list-keys -1N \"%%%\""
bind -N "List keys" '"' list-keys -N
set -g mouse on
bind -N "Toggle Mouse" ! set-option mouse

#bind -n WheelUpPane if -t = "test $(echo #{pane_current_command} |grep -e 'man' -e 'less' -e 'journalctl')" "select-pane -t = ; send-keys Up Up Up Up"  "if-shell -F -t = '#{?mouse_any_flag,1,#{pane_in_mode}}' 'send-keys -M' 'select-pane -t = ; copy-mode -e; send-keys -M'"
#bind -n WheelDownPane if -t = "test $(echo #{pane_current_command} |grep -e 'man' -e 'less' -e 'journalctl')" "select-pane -t = ; send-keys Down Down Down Down"  "if-shell -F -t = '#{?mouse_any_flag,1,#{pane_in_mode}}' 'send-keys -M' 'select-pane -t = ; copy-mode -e; send-keys -M'"


#bind -n WheelUpPane if "[[ #{pane_current_command} =~ vim ]]" "select-pane -t = ; send-keys -M" "select-pane -t = ; send-keys Up"
#bind -n WheelDownPane if "[[ #{pane_current_command} =~ vim ]]" "select-pane -t = ; send-keys -M" "select-pane -t = ; send-keys Down"

#set-option status off
bind -N "Toggle status bar" \$ set-option status
bind -N "Display info" I display "Terminal: #{client_termname} "

#bind -N "Refresh Client"   R                    refresh-client
bind -N "Rename Window" r command-prompt -p "Rename Window: " "rename-window \"%%\""
bind -N "Rename Session" R command-prompt -I "#S" "rename-session -- '%%'"

bind    -N "Search Down" '/'           copy-mode \; command-prompt -T search -p "(search down)" { send-keys -X search-forward "%%" }
bind    -N "Serch Up" '?'                      copy-mode \; command-prompt -T search -p "(search up)" { send-keys -X search-backward "%%" }



bind -N "Copy Mode" g copy-mode
bind -N "Paste contents from buffer" p paste-buffer
#bind -N "Copy Mode Up" u copy-mode 
#bind -N "Copy Mode Down" d copy-mode
bind -N "Toggle Rectangle Selection" -T copy-mode-vi V send-keys -X rectangle-toggle
bind -N "Visual Selection Mode" -T copy-mode-vi v send-keys -X begin-selection
bind -N "Visual Rectangle Selection Mode" -T copy-mode-vi C-v send-keys -X begin-selection\; send-keys -X rectangle-toggle
bind -N "Yank Selection" -T copy-mode-vi y send-keys -X copy-selection

#prevent tmux from scrolling to bottom after copying
#bind-key -T copy-mode-vi MouseDragEnd1Pane send-keys -X copy-selection -x
bind -T copy-mode MouseDragEnd1Pane send-keys -X copy-selection-no-clear
set -g @yank_action "copy-pipe"

bind -N "Yank Selection" -T copy-mode-vi y send-keys -X copy-pipe-and-cancel "pbcopy" 
bind -N "Select Word" -T copy-mode-vi s send-keys -X select-word
#bind -N "Yank Word" -T copy-mode-vi s send-keys -X select-word\; send-keys -X copy-selection\; send-keys -X cancel
#bind -N "Yank Word" -T copy-mode-vi s send-keys b \; send -X begin-selection \; send-keys E \; send -x copy-selection
bind -N "Half Page Up" -T copy-mode-vi u send-keys -X halfpage-up
bind -N "Half Page Down" -T copy-mode-vi d send-keys -X halfpage-down

bind -N "Edit Tmux Config" - new-window -n "tmux.conf" bash -c 'vim ~/.config/tmux/tmux.conf && tmux source ~/.config/tmux/tmux.conf && tmux display "tmux.conf sourced"'
bind -N "Reload Tmux Config" ) source-file ~/.config/tmux/powerline-theme.conf 
bind -N "Reload Tmux Config" _ source-file ~/.config/tmux/tmux.conf \; display 'tmux.conf sourced'
bind -N "Edit Vim Config" = new-window -n ".vimrc" bash -c 'vim ~/.vim/vimrc'

# ==========
#  Misc
# =========
setw -g aggressive-resize on
setw -g mode-keys vi
set -g status-keys vi
#set -g status-keys emacs
#### fixes the color disply, differnet emulators seem to wrok best with different settings..
#set-option -a terminal-features 'xterm-256color:RGB'
#set-option -a terminal-features 'screen-256color:RGB'  ##
set -g default-terminal "screen-256color"  # i had this on before i dont rememeber why  ##
#set-option -g default-command bash
#set -g default-terminal "xterm-256color"
# this seems to make the colors better..
# set -ga terminal-overrides ",*256col*:Tc" ##

#from primagen config
#set -ga terminal-overrides ",screen-256color*:Tc"
#set-option -g default-terminal "screen-256color"

#bind-key -n Home send Escape "OH"
#bind-key -n End send Escape "OF"
#set -s escape-time 0 # Address vim mode switching delay (http://superuser.com/a/252717/65504)
set -s escape-time 45
set -g history-limit 5000
set -g set-clipboard on

set -g base-index 1
set -wg pane-base-index 1
# (OS X) Fix pbcopy/pbpaste for old tmux versions (pre 2.6)
#set -g default-command "reattach-to-user-namespace -l $SHELL"


# ===========
# Display
# ==========

set -g display-time 2000 # tmux message dispaly duraiton
set -g display-panes-time 2000
setw -g monitor-activity on
setw -g activity-action none
setw -g renumber-windows on
set -g visual-activity off
set -g visual-bell off
#set -g focus-events on

set -g status-interval 30 #frequency in seconds to refresh status panel
set -g status-position bottom
set-option -g status-justify left

#status-right-length 40
# https://github.com/arcticicestudio/nord-tmux/blob/develop/src/nord-status-content.conf
# https://www.ditig.com/256-colors-cheat-sheet

#set -g status-left "[#{session_name}] "
#status-left-length 10
#status-left-style default

set -g set-titles on
set -g set-titles-string "[#S] #I:#W"

# ==========
#   Status Windows and Panes
# ==========





# gruvbox
# primary_color=color175 #color223
# primary_bg_color=color234
# active_color=color237
# command_color=color175
# panes_color=color175
# panes_active_color=color223
# bell_fg_color=black
# bell_bg_color=red
#
#catppuccin

# thm_bg="#1e1e2e"
# thm_fg="#cdd6f4"
# thm_cyan="#89dceb"
# thm_black="#181825"
# thm_gray="#313244"
# thm_magenta="#cba6f7"
# thm_pink="#f5c2e7"
# thm_red="#f38ba8"
# thm_green="#a6e3a1"
# thm_yellow="#f9e2af"
# thm_blue="#89b4fa"
# thm_orange="#fab387"
# thm_black4="#585b70"
#
# primary_color=$thm_green
# primary_bg_color=$thm_bg
# active_color=$thm_gray
# command_color=$thm_yellow
# panes_color=$thm_fg
# panes_active_color=$thm_green
# bell_fg_color=black
# bell_bg_color=red
#

# dim green chill
primary_color=green
primary_bg_color=color234
active_color=color237
command_color=yellow
panes_color=brightyellow
panes_active_color=brightwhite
bell_fg_color=black
bell_bg_color=red

set -g status-style fg=$primary_color,bg=$primary_bg_color    ##1F2335    #yellow and base02
set -g message-style fg=$primary_color,bright
set -g message-command-style fg=$command_color,bright

set-window-option -g window-status-style fg=default,bg=default
set-window-option -g window-status-current-style fg=default,bg=$active_color,bold
set-window-option -g window-status-activity-style fg=default,bg=default,bold

set -g status-left '#S|#{?client_prefix,b, }'
 set -g window-status-format ' #I:#W#F '
 set -g window-status-current-format ' #I:#W#F '
#set -g window-status-format " #I:#W#{?#{==:#F,}, ,#F} "
#set -g window-status-current-format " #I:#W#{?#{==:#F,}, ,#F} "

# set -g window-status-separator " "
#set -g status-right '      '
#set -g status-right ' %I:%M     '
set -g status-right '#H     '


set-option -g pane-border-style fg=default
set-option -g pane-active-border-style fg=$primary_color
set-option -g display-panes-active-colour $panes_active_color
set-option -g display-panes-colour $panes_color

set-window-option -g clock-mode-colour $primary_color
set-window-option -g window-status-bell-style fg=$bell_fg_color,bg=$bell_bg_color



